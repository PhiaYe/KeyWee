<!DOCTYPE>
<html>
  <head>
    <meta charset="utf-8">
    <title>Firebase web QuickStart </title>
    <!-- <script src="https://www.gstatic.com/firebasejs/4.10.1/firebase.js"></script> -->
    <script src="https://www.gstatic.com/firebasejs/4.10.1/firebase.js"></script>
  </head>
  <body>

    <form id="signup-form">
        Name: <br>
        <input type='text' name='name' id='name'><br>
        Password: <br>
        <input type='text' name='name' id='password'><br>
        Age: <br>
        <input type='text' name='age' id='age'><br>
        Gender: <br>
        <input type='text' name='gender' id='gender'><br>
        Email: <br>
        <input type='text' name='email' id='email'><br>
        ProfilePic: <br>
        <input type='text' name='profilePic' id='profilePic'><br>
        Description: <br>
        <textarea type='text' name='message' id='description'>
        </textarea>
        <input type='submit' value='sign-up'>
    </form>
    <!-- <script src="https://www.gstatic.com/firebasejs/4.10.1/firebase.js"></script> -->
    <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyAnbOzwuoz1Ng3k9IuNNFiIusfPkl2OfJQ",
      authDomain: "keywee-aeba7.firebaseapp.com",
      databaseURL: "https://keywee-aeba7.firebaseio.com",
      projectId: "keywee-aeba7",
      storageBucket: "keywee-aeba7.appspot.com",
      messagingSenderId: "150139905163"
    };
    firebase.initializeApp(config);


    var usersRef = firebase.database().ref('users');

    document.getElementById('signup-form').addEventListener('submit', submitSignUp);

    function submitSignUp(e) {
        e.preventDefault();
        //Get values
        var name = getInputVal('name');
        var password = getInputVal('password');
        var profilePic = getInputVal('profilePic');
        var gender = getInputVal('gender');
        var age = getInputVal('age');
        var description = getInputVal('description');
        var email = getInputVal('email');
        console.log(name);

        saveUsers(name, password, profilePic, gender, age, description, email);
    }
    //Function to get form values
    function getInputVal(id) {
        return document.getElementById(id).value;
    }



    function saveUsers(name, password, profilePic, gender, age, description, email) {
      firebase.auth().createUserWithEmailAndPassword(email, password).catch(function(error){
        var errorCode = error.code;
        var errorMessage = error.message;
        console.log(error.code);
        console.log(error.message);
      }).then(function(){

        firebase.auth().onAuthStateChanged(function(user) {
          // User is signed in.
          firebase.database().ref().child('users').child(user.uid).set({
              name: name,
              age: age,
              gender: gender,
              email: email,
              profile_picture : profilePic,
              points: 5,
              description: description
            });
        });

      firebase.auth().signInWithEmailAndPassword(email, password).catch(function(error) {
        if (error){
          // Handle Errors here.
          var errorCode = error.code;
          var errorMessage = error.message;
          console.log(error.code);
          console.log(error.message);
        }
      });
    });
    }

    </script>
  </body>
</html>
